cd main

# Commit current env
env GIT_COMMITTER_NAME="Test"
env GIT_COMMITTER_EMAIL="test@example.com"
env GIT_AUTHOR_NAME=$GIT_COMMITTER_NAME
env GIT_AUTHOR_EMAIL=$GIT_COMMITTER_EMAIL

exec git init --initial-branch=m

# Setup Go and compile
env GOPATH=$WORK/go
env GOCACHE=$WORK/gocache
env GOWORK=off
env GOFLAGS=
exec go mod tidy

exec git add .
exec git commit -m 'init'

exec go install -buildvcs=true .

# Test output
exec $WORK/go/bin/main -v
! stdout unknown
stdout 'Version: (\(devel\)|v[0-9]+\.[0-9]+\.[0-9]+-[0-9]{14}-[0-9a-f]+)'
stdout Revision:
stdout Committed:
! stderr .

exec $WORK/go/bin/main -version
! stdout unknown
! stdout done
stdout 'Version: (\(devel\)|v[0-9]+\.[0-9]+\.[0-9]+-[0-9]{14}-[0-9a-f]+)'
stdout Revision:
stdout Committed:
! stderr .

exec $WORK/go/bin/main
stdout ^done$
! stderr .


-- main/main.go --
package main

import (
    "flag"
    "fmt"

    "github.com/allanice001/versioninfo/v2"
)

func main() {
    versioninfo.AddFlag(nil)
    flag.Parse()
    fmt.Println("done")
}
